//*************************************************************************************************
// ソケット処理 (socket.h)
// Author : YUHEI KAN
//*************************************************************************************************

//*************************************************************************************************
// インクルードガード
//*************************************************************************************************
#ifndef _SOCKET_H_
#define _SOCKET_H_

//*************************************************************************************************
// インクルード
//*************************************************************************************************
#include "main.h"
#include <winsock.h>
#include <process.h>
#include "data.h"

//*************************************************************************************************
// ライブラリファイル
// [構成プロパティ]->[リンカー]->[入力]->[追加の依存ファイル]に記述しても可能
//*************************************************************************************************
#pragma comment( lib, "wsock32.lib" )           //Winsockに必要

//*************************************************************************************************
// 定数定義
//*************************************************************************************************
#define CLIENT_TO_SERVER_PORT 20000             //クライアントからサーバーへ
#define SERVER_TO_CLIENT_PORT 20001             //サーバーからクライアントへ
#define IP           "172.29.25.48"            //IPアドレス
#define MULTICAST_IP "225.0.0.2"                //マルチキャストIPアドレス
#define MESSAGE_SIZE 256                        //送受信バッファサイズ
#define MAX_PLAYER 2                            //プレイヤーの最大数

//*************************************************************************************************
// 列挙体
//*************************************************************************************************

//*************************************************************************************************
// 構造体
//*************************************************************************************************
//ユーザー情報
typedef struct {
    int m_ID;               //ID
    SOCKADDR_IN fromaddr;   //アドレス
}USER_INFO;

//*************************************************************************************************
// クラス
//*************************************************************************************************
//ソケットクラス
class CSocket
{
public:
    CSocket ( );                                 //コンストラクタ
    ~CSocket ( );                                //デコンストラクタ

    HRESULT Init ( void );                      //初期化処理
    void Uninit ( void );                       //終了処理

    static unsigned __stdcall 
        ReceiveThread ( LPVOID Param );         //受信スレッド
    static void SendData ( DATA Data );         //送信データ
    static int GetID(void);                     //IDの取得

private:
    static SOCKET m_sock;                       //Socketデータ構造体
    static SOCKET m_Sendsock;                   //Socketデータ構造体
    static int m_ID;                            //ID
    static SOCKADDR_IN m_ServerAddress;         //sockaddr_inデータ構造体
    static bool m_InitID;                       //ID初期化フラグ
    static USER_INFO m_UserInfo[MAX_PLAYER];    //ユーザー情報
};

//*************************************************************************************************
// プロトタイプ宣言
//*************************************************************************************************

#endif  //_SOCKET_H_